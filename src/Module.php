<?php
/**
 * Created by PhpStorm.
 * User: lusc
 * Date: 2017/8/9
 * Time: 23:05
 */

namespace yiiswoole;

class Module extends \yii\base\Module
{
    protected static $controllerInstances = [];

    /**
     * @param string $route
     * @return array|bool
     */
    public function createController($route)
    {
        if ($route === '') {
            $route = $this->defaultRoute;
        }
        $cacheKey = md5($this->controllerNamespace) . $route;
        if (!isset(static::$controllerInstances[$cacheKey])) {
            $controller = parent::createController($route); // TODO: Change the autogenerated stub
            if (false !== $controller) {
                static::$controllerInstances[$cacheKey] = $controller;
            }
        }
        if (isset(static::$controllerInstances[$cacheKey])) {
            return [
                clone static::$controllerInstances[$cacheKey][0],
                static::$controllerInstances[$cacheKey][1],
            ];
        } else {
            return false;
        }
    }
}
